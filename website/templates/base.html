<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Baloo+2">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lobster">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="{{url_for('static', filename="main.css")}}" type="text/css">
    <link rel = "icon" href ="{{url_for('static', filename="images/coin.png")}}" type="image/x-icon">
    <title>{% block title %}Home{% endblock %}</title>
  </head>

<body style="background-image: url({{url_for('static', filename="images/"+background)}}); min-height: 100vh; display: flex; flex-direction: column; justify-content: flex-start;">
  <div class="w3-container w3-text-white" style="height:50px; background-color:{{theme_color}}">
    <div class="w3-right" style="font-size:33px"><span id="flouze">{{user["flouze"]}}</span> <img src="{{url_for('static', filename="images/coin.png")}}" style="width:27px; position:relative; bottom:2px" alt="Coin"></div>
  </div>
  
{% block inside %} {% endblock %}

  <div id="messages" style="position:absolute; bottom:5px; display:flex; flex-direction: column; align-items:center; width:100%; font-size:16px;">
  {% with messages = get_flashed_messages(with_categories=true) %} {% if
   messages %} {% for category, message in messages %}
    {% if category == 'error' %}
    <div class="w3-pale-red w3-round-large w3-border w3-border-red w3-padding-small" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px; margin-left: 5px; margin-right: 5px;">
      <i class="fa fa-exclamation-circle w3-text-red" style="margin-right: 6px;"></i>
      <div class="w3-center">{{ message }}</div>
      <span onclick="this.parentElement.style.display='none'" class="w3-hover-gray w3-center w3-round-large" style="width: 25px; position:relative; left:3px">&times;</span>
    </div>
    {% else %}
   <div class="w3-pale-green w3-round-large w3-border w3-border-green w3-large w3-padding-small" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px; margin-left: 5px; margin-right: 5px;">
     <i class="fa fa-info-circle w3-text-green" style="margin-right: 6px;"></i>
     <div class="w3-center">{{ message }}</div>
     <span onclick="this.parentElement.style.display='none'" class="w3-hover-gray w3-center w3-large w3-round-large" style="width: 25px; position:relative; left:3px">&times;</span>
   </div>
  {% endif %} {% endfor %} {% endif %} {% endwith %}
  </div>

 <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js" integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA==" crossorigin="anonymous"></script>
  <script type="text/javascript" charset="utf-8">
    var socket = io();
    socket.on('connect', function() {
        socket.emit('give_identity', '{{user["name"]}}');
    });
    socket.on('message', function(msg) {
        document.getElementById('messages').innerHTML += `
  <div class="w3-pale-green w3-round-large w3-border w3-border-green w3-padding-small" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px; margin-left: 5px; margin-right: 5px;">
    <i class="fa fa-info-circle w3-text-green" style="margin-right: 6px;"></i>
    <div class="w3-center">` + msg + `</div>
    <span onclick="this.parentElement.style.display='none'" class="w3-hover-gray w3-center w3-large w3-round-large" style="width: 25px; position:relative; left:3px">&times;</span>
  </div>
`;
    });
    socket.on('waiting_count', function(count) {
        document.getElementById('count').innerHTML = count;
    });
    socket.on('update_data', function(changes) {
      for (i = 0; i < changes.length; i++) {
        object_id = changes[i][0];
        value = changes[i][1];
        var obj = document.getElementById(object_id);
        if (obj != null) { obj.innerHTML = value; }
      }
    });
    socket.on('reveal_card', function(card_id) {
        var card = document.getElementById('card' + card_id);
        if (card != null) {
          card.style.transform = "rotateY(180deg)";
        }
    });
    socket.on('move_to_frame', function(frame_id) {
        var frame     = document.querySelector("iframe");
        if (frame == null) return;
        var player = frame.contentWindow.sozi.player;
        player.moveToFrame(frame_id % player.presentation.frames.length);
    });
    socket.on('refresh', function() {
        window.location = window.location;
    });

    function disableBack() { window.history.forward(); }
    setTimeout("disableBack()", 0);
    window.onunload = function () { null };
  </script>

  </body>
</html>
